<html>
<head>
<meta charset=utf8>
<style>
  html {
    font-size:22px;
  }
  body {
    margin:2rem 2rem;
    font-family:Sans-Serif;
    font-size:14px;
    line-height:1rem;
  }
  table {
    font-size:14px;
    border-spacing:0;
    border:1px solid black;
    border-left:none;
    border-top:none;
    float:left;
  }
  td, th {
    border:1px solid black;
    border-bottom:none;
    border-right:none;
    padding:0 .7em;
    line-height:1.5rem;
    white-space:nowrap;
    text-align:center;
  }
  th {
    font-weight:normal;
    background:#eee;
  }
  tr:last-child th, tr:last-child td {
    border-bottom:none;
  }
  th:last-child, td:last-child {
    border-right:none;
  }
  th:first-child {
    font-family:Monospace;
  }
  tr:first-child th:first-child {
    font-family:Inherit;
  }
  td{
  }
  ul.legend {
    list-style:none;
    padding:0;
  }
  span.lbl {
    display:inline-block;
    min-width:2em;
    text-align:center;
  }
  ul, h1, table {
    margin:0 0 1rem;
  }
  table { margin-right:1rem; }
</style>
</head>
<body>
<h1>Percent Encode Sets</h1>
<!-- ␣ -->

<table>
  <tr><th>Decimal<th>Name/Symbol<th> user, pass <th> host <th> dir, file <th> query <th> special query <th> hash <th> URL code <th> C0 escape
  <tr><th>0 - 31   <th> (C0) <td> ✓             <td> ✓    <td> ✓         <td> ✓     <td> ✓      <td> ✓    <th>     <th> ✓ 
  <tr><th>32       <th> (Space) <td> ✓          <td> ✓    <td> (✓)       <td> ✓     <td> ✓      <td> ✓    <th>     <th> 
  <tr><th>33       <th> !    <td>               <td>      <td>           <td>       <td>        <td>      <th>     <th> 
  <tr><th>34       <th> "    <td> ✓             <td>      <td> (✓)       <td> ✓     <td> ✓      <td> ✓    <th> ✓   <th>  
  <tr><th>35       <th> #    <td> ✓             <td> ✓    <td> ✓         <td> ✓     <td> ✓      <td>      <th>     <th> 
  <tr><th>36       <th> $    <td>               <td>      <td>           <td>       <td>        <td>      <th>     <th> 
  <tr><th>37       <th> %    <td> .             <td> .    <td> .         <td> .     <td> .      <td> .    <th>     <th> 
  <tr><th>38       <th> &    <td>               <td>      <td>           <td>       <td>        <td>      <th>     <th> 
  <tr><th>39       <th> '    <td>               <td>      <td>           <td>       <td> ✓      <td>      <th> ✓   <th>  
  <tr><th>40 - 46  <th> ( ) * + , - . <td>      <td>      <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>47       <th> /    <td> ✓             <td> ✓    <td> ✓         <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>48 - 57  <th> 0 - 9 <td>              <td>      <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>58       <th> :    <td> ✓             <td> ✓    <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>59       <th> ;    <td> ✓             <td>      <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>60       <th> &lt; <td> ✓             <td> ✓    <td> (✓)       <td> ✓     <td> ✓      <td> ✓    <th> ✓   <th>  
  <tr><th>61       <th> =    <td> ✓             <td>      <td>           <td>       <td>        <td>      <th>     <th>  
  <tr><th>62       <th> >    <td> ✓             <td> ✓    <td> (✓)       <td> ✓     <td> ✓      <td> ✓    <th> ✓   <th>  
  <tr><th>63       <th> ?    <td> ✓             <td> ✓    <td> ✓         <td>       <td>        <td>      <th>     <th>  
  <tr><th>64       <th> @    <td> ✓             <td> ✓    <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>65 - 90  <th> A - Z <td>              <td>      <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>91       <th> [    <td> ✓             <td> ✓    <td>           <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>92       <th> \    <td> ✓             <td> S    <td> S         <td>       <td>        <td>      <th>     <th>  
  <tr><th>93       <th> ]    <td> ✓             <td> ✓    <td>           <td>       <td>        <td>      <th>     <th>  
  <tr><th>94       <th> ^    <td> ✓             <td> ✓    <td>           <td>       <td>        <td>      <th>     <th>  
  <tr><th>95       <th> _    <td>               <td>      <td>           <td>       <td>        <td>      <th>     <th>  
  <tr><th>96       <th> `    <td> ✓             <td>      <td> (✓)       <td>       <td>        <td> ✓    <th> ✓   <th>  
  <tr><th>97 - 122 <th> a - z <td>              <td>      <td>           <td>       <td>        <td>      <th>     <th>  
  <tr><th>123      <th> {    <td> ✓             <td>      <td> (✓)       <td>       <td>        <td>      <th> ✓   <th>  
  <tr><th>124      <th> |    <td> ✓             <td>      <td>           <td>       <td>        <td>      <th>     <th> 
  <tr><th>125      <th> }    <td> ✓             <td>      <td> (✓)       <td>       <td>        <td>      <th>     <th> 
  <tr><th>126      <th> ~    <td>               <td>      <td>           <td>       <td>        <td>      <th>     <th>  
  <tr><th>127      <th> (DEL) <td> ✓            <td> ✓    <td> ✓         <td> ✓     <td> ✓      <td> ✓    <th>     <th> ✓ 
  <tr><th>128 - 159<th> (C1)  <td> ✓            <td> ✓    <td> ✓         <td> ✓     <td> ✓      <td> ✓    <th>     <th> ✓ 
  <tr><th>160 - 255<th> (Latin-1) <td> A        <td> A    <td> A         <td> A     <td> A      <td> A    <th> ✓   <th> ✓ 
  <tr><th>         <th> (Surrogates) <td> ✓     <td> ✓    <td> ✓         <td> ✓     <td> ✓      <td> ✓    <th>     <th> ✓ 
  <tr><th>         <th> (Nonchars) <td> ✓       <td> ✓    <td> ✓         <td> ✓     <td> ✓      <td> ✓    <th>     <th> ✓ 
  <tr><th>         <th> (Others)  <td>  A       <td> A    <td> A         <td> A     <td> A      <td> A    <th>     <th> ✓ 
</table>

<ul class=legend>
  <li><span class=lbl >✓ </span> Escaped in all URLs
  <li><span class=lbl >(✓)</span> Escaped in all URLs except CannotBeBase URLs
  <li><span class=lbl >S</span> Escaped in Special URLs
  <li><span class=lbl >A</span> Escaped with option <code>{ ascii: true }</code>
</ul>

<script>
  const log = console.log.bind (console)

  const offsets =
    { hash:0, query:3, path:6, host:9, creds:12 }

  const R = 0b100 // Regular
  const S = 0b101 // Special (Implies Regular)
  const B = 0b010 // Nonbase

  function shouldEscape (cStr, key, mod = R) {
    const info = charInfo (cStr.codePointAt (0))
    return (info >> offsets[key] & mod) ? 1 : 0
  }

  const t32 = [
    0b111111101111111, // 32 ( )
    0b000000000000000, // 33 (!)
    0b111000101111111, // 34 (")
    0b111111111111000, // 35 (#)
    0b000000000000000, // 36 ($)
    0b000000000000000, // 37 (%)
    0b000000000000000, // 38 (&)
    0b000000000001000, // 39 (')
  ]

  const t47 = [
    0b111111111000000 // 47 (/)
  ]

  const t58 = [
    0b111111000000000, // 58 (:)
    0b111000000000000, // 59 (;)
    0b111111101111111, // 60 (<)
    0b111000000000000, // 61 (=)
    0b111000101111111, // 62(>)
    0b111111111000000, // 63 (?)
    0b111111000000000, // 64 (@)
  ]

  const t91 = [
    0b111111000000000, // 91 ([)
    0b111001001000000, // 92 (\)
    0b111111000000000, // 93 (])
    0b111111000000000, // 94 (^)
    0b000000000000000, // 95 (_)
    0b111111000101000, // 96 (`)
  ]

  const t123 = [
    0b111000101101000, // ({)
    0b111000000000000, // (|)
    0b111000101101000, // (})
    0b000000000000000, // (~)
  ]


  function charInfo (c) {
    // Escape controls and nonASCII
    if (c <= 31 || 127 <= c) return ~0
    // Lookup tables for 32-39, 47, 58-64, 91-96, 123-126
    if (32 <= c && c <= 39) return t32 [c - 32]
    if (c === 47) return t47 [c-47]
    if (58 <= c && c <= 64) return t58 [c - 58]
    if (91 <= c && c <= 96) return t91 [c - 91]
    if (123 <= c && c <= 126) return t123 [c - 123]
    // Don't escape anything else within the ASCII range
    return 0
  }

</script>

